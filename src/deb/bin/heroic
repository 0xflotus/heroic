#!/bin/bash

SHARE="/usr/share/heroic"
CONFIG_DIR="/etc/heroic"

base=$(basename $0)

case $base in
    heroic-*)
        service_type=${base#*-}
    ;;
    "heroic")
        service_type="api"
        shift
    ;;
    *)
        echo "Unknown invocation: $0"
        exit 1
    ;;
esac

JAR="$SHARE/heroic.jar"
JVMARGS="${CONFIG_DIR}/heroic-${service_type}.jvmargs"
CONFIG="${CONFIG_DIR}/heroic-${service_type}.yml"

if [[ ! -f $JAR ]]; then
    echo "Missing heroic jar: $JAR"
    exit 1
fi

if [[ ! -f $JVMARGS ]]; then
    echo "Missing jvmargs: $JVMARGS"
    exit 1
fi

if [[ ! -f $CONFIG ]]; then
    echo "Missing config: $CONFIG"
    exit 1
fi

JAVA_OPTS=$(grep -v '^\s*#' $JVMARGS)

exec env CLASSPATH="$JAR" java $JAVA_OPTS com.spotify.heroic.HeroicMain "$CONFIG"
